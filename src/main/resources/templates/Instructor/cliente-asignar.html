<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title th:text="'Asignar rutinas · ' + (${cliente.nombre} ?: 'Cliente')">Asignar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        :root{--bg:#0a0a0e;--ink:#f2f2f2;--muted:#b7b7c2;--card:#111118;--line:#1b1b25;--accent:#ffc107}
        html,body{background:var(--bg);color:var(--ink);margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
        .containerx{max-width:1000px;margin:0 auto;padding:2rem}
        .cardx{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:1rem;margin-bottom:1rem}
        .muted{color:var(--muted)}
        .checkboxes { background:#0f0f14; border:1px solid #262626; border-radius:6px; padding:.5rem; max-height:220px; overflow:auto; width:100%; }
        .checkbox-item { padding:.5rem .6rem; border-bottom:1px dashed rgba(255,255,255,0.02); display:flex; gap:.6rem; align-items:flex-start; }
        .checkbox-item:last-child { border-bottom:none; }
        .actions-row { display:flex; gap:.5rem; justify-content:flex-end; margin-top:1rem; }
        .button.is-light { background:#111216; color:#f2f2f2; border:1px solid rgba(255,255,255,.03); }
    </style>
</head>
<body>
<nav style="background:#08080a;padding:.5rem 1rem;border-bottom:1px solid rgba(255,255,255,.03)">
    <div class="containerx" style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:800;color:var(--accent)">DEBUG Gym · Instructor</div>
        <div><a class="button is-light" th:href="@{/instructor}">Volver</a></div>
    </div>
</nav>

<div class="containerx">
    <div class="cardx">
        <h2 class="title is-4" th:text="${cliente.nombre}">Cliente</h2>
        <div class="muted">Membresía: <span th:text="${membresia}">—</span></div>
    </div>

    <div class="cardx">
        <h3 class="title is-6">Asignar rutinas</h3>
        <p class="muted">Selecciona una o varias plantillas y pulsa "Asignar" para vincularlas a este cliente.</p>

        <form th:action="@{|/instructor/clientes/${cliente.id}/asignar|}" method="post">
            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div style="width:100%">
                <label class="muted">Plantillas disponibles (solo las tuyas)</label>
                <div class="checkboxes" role="listbox" aria-multiselectable="true">
                    <div th:each="p : ${plantillas}" class="checkbox-item">
                        <input type="checkbox" th:id="${'tpl-' + p.id}" name="rutinaIds" th:value="${p.id}" />
                        <div>
                            <label th:for="${'tpl-' + p.id}">
                                <strong th:text="${p.nombre}">Plantilla</strong>
                            </label>
                            <div class="muted" style="font-size:.9rem" th:text="${p.descripcion}">Descripción</div>
                        </div>
                    </div>
                    <div th:if="${#lists.isEmpty(plantillas)}" class="muted" style="padding:.6rem">No hay plantillas disponibles para asignar.</div>
                </div>

                <div class="actions-row">
                    <a class="button is-light" th:href="@{/instructor/clientes}">Cancelar</a>
                    <button type="submit" class="button" style="background:#ffc107;color:#111;padding:.45rem .9rem;border-radius:6px">Asignar</button>
                </div>
            </div>
        </form>
    </div>

    <div class="cardx" style="margin-top:1rem">
        <h3 class="title is-6">Rutinas asignadas</h3>
        <div th:if="${#lists.isEmpty(assignedRutinas)}" class="muted">No hay rutinas asignadas a este cliente.</div>
        <ul th:if="${!#lists.isEmpty(assignedRutinas)}" style="list-style:none;padding:0">
            <li th:each="r : ${assignedRutinas}" style="padding:.45rem 0;border-bottom:1px solid rgba(255,255,255,.02)">
                <div style="display:flex;align-items:center;justify-content:space-between">
                    <div>
                        <strong th:text="${r.nombre}">Rutina</strong>
                        <div class="muted" th:text="${r.descripcion}">Descripción</div>
                    </div>
                    <div style="display:flex;gap:.5rem;align-items:center">
                        <!-- Se quita el botón Editar: solo Quitar (eliminar asignación) -->
                        <form th:action="@{|/instructor/clientes/${cliente.id}/desasignar/${r.id}|}" method="post" style="display:inline" onsubmit="return confirm('¿Quitar esta rutina del cliente?');">
                            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button class="button is-small is-danger" type="submit">Quitar</button>
                        </form>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</div>
</body>
</html>