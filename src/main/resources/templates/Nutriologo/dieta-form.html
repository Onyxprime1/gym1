<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>DEBUG Gym — Dieta</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"/>

    <style>
        :root{--bg:#0a0a0e;--ink:#f2f2f2;--muted:#b7b7c2;--accent:#ffc107;--card:#111118;--line:#1b1b25}
        html,body{background:var(--bg);color:var(--ink);}
        .navbar{background:#0b0b12;border-bottom:1px solid rgba(255,255,255,.06);}
        .brand{color:var(--accent);font-weight:900;letter-spacing:.6px;}
        .cardx{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:1.5rem;}
        .muted{color:var(--muted);}
        .btn-main{background:var(--accent);color:#111;padding:.45rem .9rem;border-radius:8px;border:none;font-weight:800;}
        a{color:var(--accent);}
    </style>
</head>
<body>

<nav class="navbar">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item brand" href="/nutriologo/panel">DEBUG Gym · Nutriólogo</a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <a class="button is-light"
                       th:href="@{|/nutriologo/dietas?clienteId=${cliente.id}|}">
                        Volver a dietas
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<section class="section">
    <div class="container">
        <div class="cardx">

            <h2 class="title is-4"
                th:text="${dieta.idDieta} != null ? 'Editar dieta' : 'Nueva dieta'">
                Nueva dieta
            </h2>
            <p class="muted">
                Paciente:
                <strong th:text="${cliente.nombre}">Nombre paciente</strong>
            </p>

            <form th:action="@{/nutriologo/dietas/guardar}"
                  th:object="${dieta}" method="post">

                <!-- ID de la dieta (para edición) -->
                <input type="hidden" th:field="*{idDieta}"/>

                <!-- ID del paciente -->
                <input type="hidden" name="clienteId" th:value="${cliente.id}"/>

                <!-- Nombre de la dieta -->
                <div class="field">
                    <label class="label" for="nombre">Nombre de la dieta</label>
                    <div class="control">
                        <input id="nombre" class="input" type="text"
                               th:field="*{nombre}" required>
                    </div>
                </div>

                <!-- Descripción / plan -->
                <div class="field">
                    <label class="label" for="descripcion">Descripción / Plan (7 días, 3 comidas)</label>
                    <div class="control">
                        <textarea id="descripcion" class="textarea"
                                  th:field="*{descripcion}" rows="7"
                                  placeholder="Ejemplo:
Día 1 - Desayuno: ...
Día 1 - Comida: ...
Día 1 - Cena: ...
...
Día 7 - Cena: ..."></textarea>
                    </div>
                </div>

                <!-- Selección de platillos existentes -->
                <div class="field" style="margin-top:1rem">
                    <label class="label">Platillos incluidos en esta dieta</label>
                    <p class="muted" style="margin-bottom:.4rem">
                        Marca los platillos que formarán parte de esta dieta
                        (más adelante podrás detallar por día/horario).
                    </p>

                    <div class="control" style="max-height:220px;overflow-y:auto;
                                border:1px solid var(--line);border-radius:8px;padding:.6rem .8rem;">
                        <label class="checkbox"
                               th:each="p : ${platillosDisponibles}"
                               style="display:block;margin-bottom:.25rem;">
                            <input type="checkbox"
                                   name="platillosIds"
                                   th:value="${p.idPlatillo}"
                                   th:checked="${dieta.platillos != null and dieta.platillos.contains(p)}"/>
                            <span th:text="${p.nombre}">Nombre platillo</span>
                        </label>

                        <p class="muted" th:if="${#lists.isEmpty(platillosDisponibles)}">
                            No hay platillos registrados todavía.
                        </p>
                    </div>
                </div>

                <div class="field" style="margin-top:1rem">
                    <div class="control">
                        <button type="submit" class="btn-main">Guardar</button>
                        <a th:href="@{|/nutriologo/dietas?clienteId=${cliente.id}|}"
                           class="button is-light">Cancelar</a>
                    </div>
                </div>

            </form>

        </div>
    </div>
</section>

</body>
</html>
